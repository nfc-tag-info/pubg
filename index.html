<script>
  // ===== COUNTDOWN iki 2025-11-21 17:00 =====
  // SkaiÄiuojama pagal Å¾iÅ«rinÄiojo Ä¯renginio laiko zonÄ….
  const target = new Date(2025, 10, 21, 17, 0, 0); // 10 = lapkritis (mÄ—nesiai 0-based)
  const titleEl = document.getElementById('title');
  const el = {
    d: document.getElementById('days'),
    h: document.getElementById('hours'),
    m: document.getElementById('minutes'),
    s: document.getElementById('seconds'),
  };

  function tick(){
    const now = new Date();
    let diff = target - now;

    if (diff <= 0){
      titleEl.innerHTML = 'Susitikimas prasidÄ—jo ğŸº';
      el.d.textContent = '0';
      el.h.textContent = '00';
      el.m.textContent = '00';
      el.s.textContent = '00';
      clearInterval(iv);
      return;
    }

    const total = Math.floor(diff/1000);
    const d = Math.floor(total / 86400);
    const h = Math.floor((total % 86400) / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;

    el.d.textContent = d;
    el.h.textContent = String(h).padStart(2,'0');
    el.m.textContent = String(m).padStart(2,'0');
    el.s.textContent = String(s).padStart(2,'0');
  }
  tick();
  const iv = setInterval(tick, 1000);

  // ===== PUBG paieÅ¡ka (atidaro pubg.op.gg) =====
  document.getElementById('pubgSearch').addEventListener('submit', function(e){
    e.preventDefault();
    const name = document.getElementById('pubgName').value.trim();
    const hint = document.getElementById('pubgHint');

    if(!name){
      hint.textContent = 'Ä®raÅ¡yk Å¾aidÄ—jo vardÄ… (nikÄ…).';
      return;
    }

    const url = `https://pubg.op.gg/user/${encodeURIComponent(name)}`;
    hint.innerHTML = `Atidaroma: <a href="${url}" target="_blank" rel="noopener" style="color:#ffcc00">${url}</a>`;
    window.open(url, '_blank', 'noopener');
  });

  /* ===== MINI Å½AIDIMAS (Canvas â€runnerâ€œ) ===== */
  const overlay = document.getElementById('gameOverlay');
  const openBtn = document.getElementById('openGame');
  const closeBtn = document.getElementById('closeGame');
  const pauseBtn = document.getElementById('pauseBtn');
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const hiscoreEl = document.getElementById('hiscore');

  let running = false, paused = false, raf = null, lastT = 0;
  let score = 0, hiscore = Number(localStorage.getItem('runner_hiscore') || 0);
  hiscoreEl.textContent = hiscore;

  const GROUND_Y = cvs.height - 40;
  const GRAV = 2000;
  const JUMP_V = -700;

  // ğŸ”¹ greiÄio logika: bazinis greitis + proporcingas didÄ—jimas nuo taÅ¡kÅ³
  const BASE_SPEED = 300;          // pradinÄ—
  let speed = BASE_SPEED;          // realiai naudojamas greitis
  const MAX_SCALE_SCORE = 130;     // ~nuo Å¡ito kiekio greitis ~2x
  const SPEED_ACCEL = 800;         // kiek greitai prisitaiko prie target greiÄio (px/s^2)

  const player = { x:60, y:GROUND_Y-40, w:34, h:40, vy:0, onGround:true };
  const obstacles = [];
  let spawnTimer = 0;

  function resetGame(){
    score = 0;
    speed = BASE_SPEED;
    spawnTimer = 0;
    player.y = GROUND_Y-40;
    player.vy = 0;
    player.onGround = true;
    obstacles.length = 0;
    lastT = performance.now();
    scoreEl.textContent = score;
  }

  function jump(){
    if (!running || paused) return;
    if (player.onGround){
      player.vy = JUMP_V;
      player.onGround = false;
    }
  }

  function spawnObstacle(){
    const h = 20 + Math.floor(Math.random()*16);
    const w = 20 + Math.floor(Math.random()*16);
    obstacles.push({ x:cvs.width+20, y:GROUND_Y-h, w, h, passed:false });
  }

  function update(dt){
    // ğŸ”¹ ApskaiÄiuojame tikslinÄ¯ greitÄ¯ pagal taÅ¡kus
    const clampedScore = Math.min(score, MAX_SCALE_SCORE); // kad virÅ¡ 130 nebeÅ¡oktÅ³ be galo
    const targetSpeed = BASE_SPEED * (1 + clampedScore / MAX_SCALE_SCORE); 
    // t.y. score=0 -> 1x, score=MAX_SCALE_SCORE -> 2x

    // ğŸ”¹ â€minkÅ¡taiâ€œ artÄ—jame prie target speed (kad nebÅ«tÅ³ staigiÅ³ Å¡uoliÅ³)
    if (speed < targetSpeed){
      speed = Math.min(targetSpeed, speed + SPEED_ACCEL * dt);
    } else if (speed > targetSpeed){
      speed = Math.max(targetSpeed, speed - SPEED_ACCEL * dt);
    }

    // Å¾aidÄ—jo fizika
    player.vy += GRAV * dt;
    player.y += player.vy * dt;
    if (player.y >= GROUND_Y - player.h){
      player.y = GROUND_Y - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // kliÅ«ÄiÅ³ generacija (pagal laikÄ…, ne atstumÄ…)
    spawnTimer -= dt;
    if (spawnTimer <= 0){
      spawnObstacle();
      // kai greitis didesnis, ir taip â€sunkiauâ€œ, todÄ—l spawn intervalÄ… paliekam panaÅ¡Å³
      spawnTimer = 0.9 + Math.random()*0.9;
    }

    for (const o of obstacles){
      // kliÅ«tys juda pagal dabartinÄ¯ greitÄ¯
      o.x -= speed * dt;

      // prabÄ—go kliÅ«tÄ¯ â€“ taÅ¡kas
      if (!o.passed && o.x + o.w < player.x){
        o.passed = true;
        score++;
        scoreEl.textContent = score;
      }

      // susidÅ«rimas
      if (rectsCollide(player, o)){
        gameOver();
        return;
      }
    }

    // paÅ¡alinam senas kliÅ«tis
    while (obstacles.length && obstacles[0].x + obstacles[0].w < -10){
      obstacles.shift();
    }
  }

  function draw(){
    ctx.clearRect(0, 0, cvs.width, cvs.height);

    // Å¾emÄ—
    ctx.fillStyle = '#152337';
    ctx.fillRect(0, GROUND_Y, cvs.width, 4);

    // foninÄ—s juostos
    ctx.fillStyle = 'rgba(255,255,255,.05)';
    for (let i=0; i<6; i++){
      const x = (i*180 - (performance.now()/20)%180);
      ctx.fillRect(x, GROUND_Y-18, 120, 2);
    }

    // kliÅ«tys
    for (const o of obstacles){
      ctx.fillStyle = '#ffcc00';
      roundRect(ctx, o.x, o.y, o.w, o.h, 4, true);
    }

    // Å¾aidÄ—jas (karys)
    ctx.fillStyle = '#ffffff';
    roundRect(ctx, player.x, player.y, player.w, player.h, 6, true); // kÅ«nas
    ctx.fillStyle = '#0b1220';                   // Å¡almas
    ctx.fillRect(player.x+4, player.y+4, player.w-8, 10);
    ctx.fillStyle = '#ffcc00';                   // stiklas
    ctx.fillRect(player.x+8, player.y+6, player.w-16, 6);

    if (paused){
      ctx.fillStyle = 'rgba(0,0,0,.35)';
      ctx.fillRect(0,0,cvs.width,cvs.height);
      drawCenterText('PauzÄ— â€” P arba TAP, kad tÄ™sti', 16);
    }
  }

  function loop(ts){
    if (!running) return;
    const dt = Math.min(0.05, (ts - lastT)/1000);
    lastT = ts;
    if (!paused){
      update(dt);
      draw();
    }
    raf = requestAnimationFrame(loop);
  }

  function rectsCollide(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  function drawCenterText(text, size){
    ctx.fillStyle = '#fff';
    ctx.font = `bold ${size}px system-ui,-apple-system,Segoe UI,Roboto,Arial`;
    ctx.textAlign = 'center';
    ctx.fillText(text, cvs.width/2, cvs.height/2);
  }

  function gameOver(){
    running = false;
    cancelAnimationFrame(raf);
    ctx.fillStyle = 'rgba(0,0,0,.55)';
    ctx.fillRect(0,0,cvs.width,cvs.height);
    drawCenterText(`Game Over â€” taÅ¡kai: ${score}`, 22);
    setTimeout(()=>drawCenterText('Space/â†‘ arba TAP â€” dar kartÄ…', 16), 60);

    if (score > hiscore){
      hiscore = score;
      localStorage.setItem('runner_hiscore', String(hiscore));
      hiscoreEl.textContent = hiscore;
    }

    const restartKey = (e)=>{
      if (e.code==='Space' || e.code==='ArrowUp'){
        window.removeEventListener('keydown', restartKey);
        cvs.removeEventListener('pointerdown', restartTap);
        startGame();
      }
    };
    const restartTap = ()=>{
      window.removeEventListener('keydown', restartKey);
      cvs.removeEventListener('pointerdown', restartTap);
      startGame();
    };
    window.addEventListener('keydown', restartKey);
    cvs.addEventListener('pointerdown', restartTap);
  }

  function startGame(){
    resetGame();
    running = true;
    paused = false;
    pauseBtn.textContent = 'â¸ï¸ PauzÄ— (P)';
    lastT = performance.now();
    raf = requestAnimationFrame(loop);
  }

  function togglePause(){
    if (!running) return;
    paused = !paused;
    pauseBtn.textContent = paused ? 'â–¶ TÄ™sti (P)' : 'â¸ï¸ PauzÄ— (P)';
  }

  // UI valdymas
  openBtn.addEventListener('click', ()=>{
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
    setTimeout(startGame, 50);
  });

  closeBtn.addEventListener('click', ()=>{
    running = false;
    cancelAnimationFrame(raf);
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
  });

  pauseBtn.addEventListener('click', togglePause);

  window.addEventListener('keydown', (e)=>{
    if (overlay.style.display !== 'flex') return;
    if (e.code === 'Space' || e.code === 'ArrowUp'){
      e.preventDefault();
      jump();
    }
    if (e.code === 'KeyP'){
      togglePause();
    }
  });

  cvs.addEventListener('pointerdown', ()=>{
    if (overlay.style.display !== 'flex') return;
    if (paused) togglePause();
    else jump();
  });

  function roundRect(ctx, x, y, w, h, r, fill){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
    if (fill) ctx.fill();
  }
</script>
