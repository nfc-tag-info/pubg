<!-- ... TAVO <head> ir CSS palik tokį pat (su didesniu, šviesesniu logo) ... -->

<!-- Po datos eilutės įterpk šį bloką -->
<section style="margin-top:1.5rem">
  <h2 style="text-align:center;color:#fff;margin:0 0 .75rem 0;font-size:1.15rem">
    PUBG statistika
  </h2>

  <form id="statsForm" style="display:flex;gap:.5rem;justify-content:center;flex-wrap:wrap">
    <input id="names" type="text" placeholder="Pvz.: friend1, friend2"
           style="min-width:260px;padding:.6rem .8rem;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#fff">
    <select id="platform" title="Platforma" style="padding:.6rem .8rem;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#fff">
      <option value="steam" selected>Steam</option>
      <option value="kakao">Kakao</option>
      <option value="psn">PSN</option>
      <option value="xbox">Xbox</option>
    </select>
    <button class="btn" type="submit" style="padding:.6rem 1rem;border-radius:10px;border:none;background:linear-gradient(90deg,#ffcc00,#ffb300);color:#0b0b0b;font-weight:700;cursor:pointer">
      Ieškoti
    </button>
  </form>

  <div id="stats" style="margin-top:1rem"></div>
</section>

<script>
/* ====== PUBG STATS ======
   Naudoja tavo backend endpointą /api/pubg?names=A,B&platform=steam
   (žiūrėk 2 skyrių – Cloudflare Worker)
*/
const $stats = document.getElementById('stats');
document.getElementById('statsForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const names = document.getElementById('names').value.trim();
  const platform = document.getElementById('platform').value;
  if (!names) { $stats.innerHTML = '<p style="text-align:center">Įrašyk bent vieną niką.</p>'; return; }

  $stats.innerHTML = card('Kraunama...', '');

  try {
    const r = await fetch(`/api/pubg?names=${encodeURIComponent(names)}&platform=${encodeURIComponent(platform)}`);
    const data = await r.json();
    if (!r.ok) throw new Error(data.error || 'Nepavyko gauti duomenų');

    // Renderis
    const parts = [];
    if (data.players?.length) {
      parts.push(tablePlayers(data.players));
    }
    if (data.total) {
      parts.push(tableTotal(data.total));
    }
    $stats.innerHTML = parts.join('');
  } catch (err) {
    $stats.innerHTML = card('Klaida', `<p style="margin:0.5rem 0 0">${err.message}</p>`);
  }
});

// UI helperiai
function card(title, body){
  return `
  <div style="background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:1rem;margin-top:.75rem">
    <div style="color:#fff;font-weight:700;margin-bottom:.25rem">${title}</div>
    ${body}
  </div>`;
}

function tablePlayers(players){
  const rows = players.map(p => {
    const g = p.gameModeStats || {};
    const agg = aggregateModes(g);
    return `
      <tr>
        <td style="padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${p.name}</td>
        <td style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${agg.rounds}</td>
        <td style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${agg.wins}</td>
        <td style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${agg.kills}</td>
        <td style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${agg.assists}</td>
        <td style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.06)">${(agg.damage).toFixed(0)}</td>
      </tr>`;
  }).join('');
  return card('Žaidėjai (lifetime)', `
    <div style="overflow:auto">
    <table style="width:100%;border-collapse:collapse;font-size:.95rem;color:#cfd7e3">
      <thead>
        <tr style="color:#fff">
          <th style="text-align:left;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Vardas</th>
          <th style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Mačai</th>
          <th style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Pergalės</th>
          <th style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Nuš.</th>
          <th style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Asist.</th>
          <th style="text-align:right;padding:.5rem .6rem;border-bottom:1px solid rgba(255,255,255,.12)">Žala</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
    </div>
  `);
}

function tableTotal(t){
  return card('Bendra suma', `
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      ${chip('Mačai', t.rounds)}
      ${chip('Pergalės', t.wins)}
      ${chip('Nušauta', t.kills)}
      ${chip('Asistai', t.assists)}
      ${chip('Žala', Math.round(t.damage))}
    </div>
  `);
}
function chip(label, value){
  return `<div style="padding:.6rem .8rem;border-radius:10px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08)"><div style="color:#fff;font-weight:700">${value}</div><div style="font-size:.8rem;color:#cfd7e3">${label}</div></div>`;
}

// Sumuoja per visus game modes (solo/duo/squad ir t.t.)
function aggregateModes(gms){
  const keys = Object.keys(gms);
  const out = { rounds:0,wins:0,kills:0,assists:0,damage:0 };
  keys.forEach(k=>{
    const m = gms[k] || {};
    out.rounds += m.roundsPlayed || 0;
    out.wins += m.wins || 0;
    out.kills += m.kills || 0;
    out.assists += m.assists || 0;
    out.damage += m.damageDealt || 0;
  });
  return out;
}
</script>
